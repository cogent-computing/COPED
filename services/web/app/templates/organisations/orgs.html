{% extends "base.html" %}
{% load static %}
{% block title %}Organisations{% endblock title %}

{% block nav_org%}active{% endblock %}

{% block content %}
<!-- Masthead-->

<!-- Breadcrumb -->
<nav aria-label="breadcrumb" class="main-breadcrumb ">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">Organisations</li>
    </ol>
</nav>
<!-- /Breadcrumb -->
<div class="gutters-sm pl-4 pr-4">
    <form action="/orgs/">
    <div class="row pt-3 col-12">
        {% if user.is_authenticated is True %}
        <div class="col-auto p-1">
            <a class="btn btn-lg btn-info" id="add_user">
                <i class="far fa-plus-square"></i> <b>Add Organisation</b></a>
        </div>
        {% endif %}
        <div class="col p-1">
            <input class="form-control form-control-lg" name="search" type="text" value="{{search}}"
                   placeholder="Search for organisations..."></div>
        <div class="col-auto p-1">
            <button class="btn btn-lg btn-primary" type="submit" >Search</button>
        </div>
        {% if search is None %}
        <div class="col-auto p-1">
            <a class="btn btn-sm btn-outline-secondary" href="/api/v1/organisations/all/csv/"
               download="full_organisations.csv" style="line-height:1.4;">
                <i class="fas fa-cloud-download-alt"></i> Download </br>full organisations list</a>
        </div>
        {% else %}
        <div class="col-auto p-1">
            <a class="btn btn-sm btn-outline-secondary" href="/api/v1/search/organisations/csv/?search={{search}}"
            download="organisation_search.csv" style="line-height:1.4;">
               <i class="fas fa-cloud-download-alt"></i> Download </br> search results</a>
        </div>
        {% endif %}
    </div>
    </form>
</div>

<div class="pt-3 gutters-sm pl-5 pr-5">

    <div class="row w-100 row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5">
        {% for org in organisation %}
        <div class="col mb-4">
            <div class="card  h-100 shadow">
                <img class="card-img-top" src="/return_images/?uid={{org.id}}&type=organisation" alt="Card image cap">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">{{ org.name }}</h5>
                    <h6 class="card-subtitle mb-2 text-muted" style="white-space:pre-wrap;">{{org.address}}</h6>
                    <p class="card-text"></p> <!-- Maybe add projects  -->
                    <div class="text-center" style="margin-top:auto;">
                        <a class="mt-auto btn btn-outline-primary" href={{org.link}}>View profile</a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}

    </div>
</div>

<div class="text-center">
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">

            {% if curr_page == 1 %}
            <li class="page-item disabled">
                <a class="page-link" href="/orgs/?page={{min_nr}}&search={{search}}" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                    <span class="sr-only">Previous</span>
                </a>
            </li>
            <li class="page-item disabled">
                <a class="page-link" href="/orgs/?page={{prev_nr}}&search={{search}}" tabindex="-1">Previous</a>
            </li>
            {% else %}
            <li class="page-item">
                <a class="page-link" href="/orgs/?page={{min_nr}}&search={{search}}" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                    <span class="sr-only">Previous</span>
                </a>
            </li>
            <li class="page-item">
                <a class="page-link" href="/orgs/?page={{prev_nr}}&search={{search}}" tabindex="-1">Previous</a>
            </li>
            {% endif %}

            {% for p in page_nrs %}
            {% if p == curr_page %}
            <li class="page-item">
                <p class="page-link text-dark">{{ p }} </p>
            </li>
            {% else %}
            <li class="page-item"><a class="page-link" href="/orgs/?page={{p}}&search={{search}}">{{p}}</a></li>
            {% endif %}
            {% endfor %}

            {% if curr_page != max_page %}
            <li class="page-item">
                <a class="page-link" href="/orgs/?page={{next_nr}}&search={{search}}">Next</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="/orgs/?page={{max_nr}}&search={{search}}" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                    <span class="sr-only">Next</span>
                </a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <a class="page-link" href="/orgs/?page={{next_nr}}&search={{search}}">Next</a>
            </li>
            <li class="page-item disabled">
                <a class="page-link" href="/orgs/?page={{max_nr}}&search={{search}}" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                    <span class="sr-only">Next</span>
                </a>
            </li>
            {% endif %}
            <form class="form-inline">
                <div class="form-group ml-3 mb-2">
                    <input type="hidden" name="search" value="{{search}}">
                    <label for="page_nr" class="mr-1">Go to</label>
                    <input type="number" class="form-control" id="page_nr" min="1" max={{max_page}}
                           name="page" placeholder="page" required="true" style="max-width:60px;width:auto">
                </div>
                <button type="submit" class="btn btn-primary mx-sm-1 mb-2">Go</button>
            </form>
        </ul>
    </nav>
</div>

<!-- /.container -->
<script>
$(document).ready(function(){
  $("#add_user").click(function(event){
     event.preventDefault();
     window.location.href = "/add_org/";
  });
});
</script>

{% endblock content %}
